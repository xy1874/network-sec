# 实验原理

SQL 注入可以影响任何使用了 SQL 数据库的网站或应用程序，例如常用的数据库 MySQL、Oracle、SQL Server 等，攻击者利用它，便能无需授权地访问你的敏感数据，比如：用户资料、个人数据、商业机密等，也可以修改修改数据库的内容，包括删除数据库表。

SQL 注入是注入是最古老和最危险的Web应用程序漏洞之一。每年 OWASP（开放 Web 应用程序安全项目）都会发布十大安全漏洞。它代表了对 Web 应用程序最关键的安全风险的广泛共识，注入漏洞近几年都在TOP 10 之列 [OWASP TOP10](https://owasp.org/www-project-top-ten/) 。

SQL 注入带来的威胁主要有如下几点：

1. 猜解后台数据库，这是利用最多的方式，盗取网站的敏感信息；
2. 绕过认证，列如绕过验证登录网站后台；
3. 注入可以借助数据库的存储过程进行提权等操作。

## 1 SQL 注入对数据安全的影响

1. 数据库信息泄漏：数据库中存放的用户的隐私信息的泄露。
2. 网页篡改：通过操作数据库对特定网页进行篡改。
3. 网站被挂马，传播恶意软件：修改数据库一些字段的值，嵌入网马链接，进行挂马攻击。
4. 数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。
5. 服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。
6. 破坏硬盘数据，瘫痪全系统。

**示例** ： 2011年6月，LulzSec的黑客组织攻击了索尼公司网站，并获取了100万用户的个人信息，包括用户名，密码，家庭住址，生日等一些敏感信息。造成了很大的影响。LulzSec组织声称入侵手段就是简单的SQL注入技术，通过SQL注入，就获取到了全部的敏感信息。

## 2 SQL 注入分类及判断

### 2.1 按数据类型分类

1. 数字型注入点

​在 Web 端大概是 http://xxx.com/news.php?id=1 这种形式，其注入点 id 类型为数字，所以叫数字型注入点。这一类的 SQL 语句原型大概为：

```
select * from 表名 where id=1
```

组合出来的sql注入语句如下，就：

```
select * from news where id=1 and 1=1
```

2. 字符型注入点

在 Web 端大概是 http://xxx.com/news.php?name=admin 这种形式，其注入点 name 类型为字符类型，所以叫字符型注入点。这一类的 SQL 语句原型大概为

```
select * from 表名 where name='admin'   注意多了引号
```

组合出来的sql注入语句为：

```
select * from news where name='admin' and 1=1 ' '
```

如果有组合条件

```
select * from 表名 where name='admin' and passwd='!QAZ2wsx'  注意多了引号
```

组合出来的sql注入语句为：

```
select * from news where name='admin' # and passwd='  // 如果用admin只需要在对话框输入 admin' #

select * from news where name='admin' # and passwd='  // 只需要在对话框输入 ' or 1=1 #
```

3. 搜索型注入点

这类注入主要是指在进行数据搜索时没过滤搜索参数，一般在链接地址中有“keyword=关键字”，有的不显示在的链接地址里面，而是直接通过搜索框表单提交。此类注入点提交的 SQL 语句，其原形大致为：

```
select * from 表名 where 字段 like '%关键字%'`
```


组合出来的sql注入语句为：

```
select * from news where search like '%测试 %' and '%1%'='%1%'

测试%' union select 1,2,3,4 and '%'='
```

## 3 防御 SQL 注入漏洞

1. 使用特定语言的库函数来代替shell命令和系统调用；
2. 对用户输入的信息进行严格检查和过滤： 
   
   数据类型（字符串、整数等）正确吗？ 
   
   使用的是允许的字符集？ 
   
   输入满足格式要求吗？ 

3. 使用“最小权限”限制数据库用户的权限。
